/**
* author: Timothy Groves - http://www.brandspankingnew.net
* version: 1.2 - 2006-11-17
* 1.3 - 2006-12-04
* 2.0 - 2007-02-07
* 2.1.1 - 2007-04-13
* 2.1.2 - 2007-07-07
* 2.1.3 - 2007-07-19
* 2.1.4 - 2012-10-25
*
*/typeof bsn=="undefined"&&(_b=bsn={}),typeof _b.Autosuggest=="undefined"?_b.Autosuggest={}:alert("Autosuggest is already set!"),_b.AutoSuggest=function(e,t){if(!document.getElementById)return 0;this.fld=_b.DOM.gE(e);if(!this.fld)return 0;this.sInp="",this.nInpC=0,this.aSug=[],this.iHigh=0,this.oP=t?t:{};var n,r={minchars:1,meth:"get",varname:"input",className:"autosuggest",timeout:2500,delay:500,offsety:-5,shownoresults:!0,noresults:"No results!",maxheight:250,cache:!0,maxentries:25,showerrors:!0};for(n in r)typeof this.oP[n]!=typeof r[n]&&(this.oP[n]=r[n]);var i=this;this.fld.onkeypress=function(e){return i.onKeyPress(e)},this.fld.onkeyup=function(e){return i.onKeyUp(e)},this.fld.setAttribute("autocomplete","off")},_b.AutoSuggest.prototype.onKeyPress=function(e){var t=window.event?window.event.keyCode:e.keyCode,n=13,r=9,i=27,s=1;switch(t){case n:this.setHighlightedValue(),s=0;break;case i:this.clearSuggestions()}return s},_b.AutoSuggest.prototype.onKeyUp=function(e){var t=window.event?window.event.keyCode:e.keyCode,n=38,r=40,i=1;switch(t){case n:this.changeHighlight(t),i=0;break;case r:this.changeHighlight(t),i=0;break;default:this.getSuggestions(this.fld.value)}return i},_b.AutoSuggest.prototype.getSuggestions=function(e){if(e==this.sInp)return 0;_b.DOM.remE(this.idAs),this.sInp=e;if(e.length<this.oP.minchars)return this.aSug=[],this.nInpC=e.length,0;var t=this.nInpC;this.nInpC=e.length?e.length:0;var n=this.aSug.length;if(this.nInpC>t&&n&&n<this.oP.maxentries&&this.oP.cache){var r=[];for(var i=0;i<n;i++)this.aSug[i].value.substr(0,e.length).toLowerCase()==e.toLowerCase()&&r.push(this.aSug[i]);return this.aSug=r,this.createList(this.aSug),!1}var s=this,o=this.sInp;return clearTimeout(this.ajID),this.ajID=setTimeout(function(){s.doAjaxRequest(o)},this.oP.delay),!1},_b.AutoSuggest.prototype.doAjaxRequest=function(e){if(e!=this.fld.value)return!1;var t=this;if(typeof this.oP.script=="function")var n=this.oP.script(encodeURIComponent(this.sInp));else var n=this.oP.script+this.oP.varname+"="+encodeURIComponent(this.sInp);if(!n)return!1;var r=this.oP.meth,e=this.sInp,i=this.oP.showerrors,s=function(n){t.setSuggestions(n,e)},o=function(e){i===!0&&alert("AJAX error: "+e)},u=new _b.Ajax;u.makeRequest(n,r,s,o)},_b.AutoSuggest.prototype.setSuggestions=function(req,input){if(input!=this.fld.value)return!1;this.aSug=[];if(this.oP.json){var jsondata=eval("("+req.responseText+")");for(var i=0;i<jsondata.results.length;i++)this.aSug.push({id:jsondata.results[i].id,value:jsondata.results[i].value,info:jsondata.results[i].info})}else{var xml=req.responseXML,results=xml.getElementsByTagName("results")[0].childNodes;for(var i=0;i<results.length;i++)results[i].hasChildNodes()&&this.aSug.push({id:results[i].getAttribute("id"),value:results[i].childNodes[0].nodeValue,info:results[i].getAttribute("info")})}this.idAs="as_"+this.fld.id,this.createList(this.aSug)},_b.AutoSuggest.prototype.createList=function(e){var t=this;_b.DOM.remE(this.idAs),this.killTimeout();if(e.length==0&&!this.oP.shownoresults)return!1;var n=_b.DOM.cE("div",{id:this.idAs,className:this.oP.className}),r=_b.DOM.cE("div",{className:"as_corner"}),i=_b.DOM.cE("div",{className:"as_bar"}),s=_b.DOM.cE("div",{className:"as_header"});s.appendChild(r),s.appendChild(i),n.appendChild(s);var o=_b.DOM.cE("ul",{id:"as_ul"});for(var u=0;u<e.length;u++){var a=e[u].value,f=a.toLowerCase().indexOf(this.sInp.toLowerCase()),l=a.substring(0,f)+"<em>"+a.substring(f,f+this.sInp.length)+"</em>"+a.substring(f+this.sInp.length),c=_b.DOM.cE("span",{},l,!0);if(e[u].info!=""){var h=_b.DOM.cE("br",{});c.appendChild(h);var p=_b.DOM.cE("small",{},e[u].info);c.appendChild(p)}var d=_b.DOM.cE("a",{href:"#"}),v=_b.DOM.cE("span",{className:"tl"}," "),m=_b.DOM.cE("span",{className:"tr"}," ");d.appendChild(v),d.appendChild(m),d.appendChild(c),d.name=u+1,d.onclick=function(){return t.setHighlightedValue(),!1},d.onmouseover=function(){t.setHighlight(this.name)};var g=_b.DOM.cE("li",{},d);o.appendChild(g)}if(e.length==0&&this.oP.shownoresults){var g=_b.DOM.cE("li",{className:"as_warning"},this.oP.noresults);o.appendChild(g)}n.appendChild(o);var y=_b.DOM.cE("div",{className:"as_corner"}),b=_b.DOM.cE("div",{className:"as_bar"}),w=_b.DOM.cE("div",{className:"as_footer"});w.appendChild(y),w.appendChild(b),n.appendChild(w);var E=_b.DOM.getPos(this.fld);n.style.left=E.x+"px",n.style.top=E.y+this.fld.offsetHeight+this.oP.offsety+"px",n.style.width=this.fld.offsetWidth+"px",n.onmouseover=function(){t.killTimeout()},n.onmouseout=function(){t.resetTimeout()},document.getElementsByTagName("body")[0].appendChild(n),this.iHigh=0;var t=this;this.toID=setTimeout(function(){t.clearSuggestions()},this.oP.timeout)},_b.AutoSuggest.prototype.changeHighlight=function(e){var t=_b.DOM.gE("as_ul");if(!t)return!1;var n;e==40?n=this.iHigh+1:e==38&&(n=this.iHigh-1),n>t.childNodes.length&&(n=t.childNodes.length),n<1&&(n=1),this.setHighlight(n)},_b.AutoSuggest.prototype.setHighlight=function(e){var t=_b.DOM.gE("as_ul");if(!t)return!1;this.iHigh>0&&this.clearHighlight(),this.iHigh=Number(e),t.childNodes[this.iHigh-1].className="as_highlight",this.killTimeout()},_b.AutoSuggest.prototype.clearHighlight=function(){var e=_b.DOM.gE("as_ul");if(!e)return!1;this.iHigh>0&&(e.childNodes[this.iHigh-1].className="",this.iHigh=0)},_b.AutoSuggest.prototype.setHighlightedValue=function(){this.iHigh&&(this.sInp=this.fld.value=this.aSug[this.iHigh-1].value,this.fld.focus(),this.fld.selectionStart&&this.fld.setSelectionRange(this.sInp.length,this.sInp.length),this.clearSuggestions(),typeof this.oP.callback=="function"&&this.oP.callback(this.aSug[this.iHigh-1]))},_b.AutoSuggest.prototype.killTimeout=function(){clearTimeout(this.toID)},_b.AutoSuggest.prototype.resetTimeout=function(){clearTimeout(this.toID);var e=this;this.toID=setTimeout(function(){e.clearSuggestions()},1e3)},_b.AutoSuggest.prototype.clearSuggestions=function(){this.killTimeout();var e=_b.DOM.gE(this.idAs),t=this;if(e)var n=new _b.Fader(e,1,0,250,function(){_b.DOM.remE(t.idAs)})},typeof _b.Ajax=="undefined"&&(_b.Ajax={}),_b.Ajax=function(){this.req={},this.isIE=!1},_b.Ajax.prototype.makeRequest=function(e,t,n,r){t!="POST"&&(t="GET"),this.onComplete=n,this.onError=r;var i=this;window.XMLHttpRequest?(this.req=new XMLHttpRequest,this.req.onreadystatechange=function(){i.processReqChange()},this.req.open("GET",e,!0),this.req.send(null)):window.ActiveXObject&&(this.req=new ActiveXObject("Microsoft.XMLHTTP"),this.req&&(this.req.onreadystatechange=function(){i.processReqChange()},this.req.open(t,e,!0),this.req.send()))},_b.Ajax.prototype.processReqChange=function(){this.req.readyState==4&&(this.req.status==200?this.onComplete(this.req):this.onError(this.req.status))},typeof _b.DOM=="undefined"&&(_b.DOM={}),_b.DOM.cE=function(e,t,n,r){var i=document.createElement(e);if(!i)return 0;for(var s in t)i[s]=t[s];var o=typeof n;return o=="string"&&!r?i.appendChild(document.createTextNode(n)):o=="string"&&r?i.innerHTML=n:o=="object"&&i.appendChild(n),i},_b.DOM.gE=function(e){var t=typeof e;if(t=="undefined")return 0;if(t=="string"){var n=document.getElementById(e);return n?typeof n.appendChild!="undefined"?n:0:0}return typeof e.appendChild!="undefined"?e:0},_b.DOM.remE=function(e){var t=this.gE(e);return t?t.parentNode.removeChild(t)?!0:0:0},_b.DOM.getPos=function(e){var e=this.gE(e),t=e,n=0;if(t.offsetParent)while(t.offsetParent)n+=t.offsetLeft,t=t.offsetParent;else t.x&&(n+=t.x);var t=e,r=0;if(t.offsetParent)while(t.offsetParent)r+=t.offsetTop,t=t.offsetParent;else t.y&&(r+=t.y);return{x:n,y:r}},typeof _b.Fader=="undefined"&&(_b.Fader={}),_b.Fader=function(e,t,n,r,i){if(!e)return 0;this.e=e,this.from=t,this.to=n,this.cb=i,this.nDur=r,this.nInt=50,this.nTime=0;var s=this;this.nID=setInterval(function(){s._fade()},this.nInt)},_b.Fader.prototype._fade=function(){this.nTime+=this.nInt;var e=Math.round(this._tween(this.nTime,this.from,this.to,this.nDur)*100),t=e/100;if(this.e.filters)try{this.e.filters.item("DXImageTransform.Microsoft.Alpha").opacity=e}catch(n){this.e.style.filter="progid:DXImageTransform.Microsoft.Alpha(opacity="+e+")"}else this.e.style.opacity=t;this.nTime==this.nDur&&(clearInterval(this.nID),this.cb!=undefined&&this.cb())},_b.Fader.prototype._tween=function(e,t,n,r){return t+(n-t)*(e/r)};